{% extends "base.html" %}
{% block title %}Login student{% endblock %}
{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Login</h1>
    <form id="login-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="phone">Phone:</label>
            <input type="number" maxlength="10" class="form-control" id="phone" name="phone" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <button type="button" class="btn btn-primary" id="login-btn">Login</button>
    </form>
</div>

<script>
     document.getElementById("login-btn").addEventListener("click", function(){
        const phone = document.getElementById('phone').value;
        const password = document.getElementById('password').value;

        axios.post('/api/students/loginview/', { phone, password }, {
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrf-token]').content,
                'Content-Type': 'application/json'
            }
        })
        .then((response) => {
            const { access, refresh, is_superuser } = response.data;
            localStorage.setItem('access_token', access);
            localStorage.setItem('refresh_token', refresh);
            console.log(is_superuser)
            if (is_superuser) {
                window.location.href = '/api/student/registerPage/';
            } else {
                window.location.href = '/api/studentupdateform/';
            }
        })
        .catch(function(error) {
            alert('Registration failed: ' + JSON.stringify(error.response.data));
            
        });
    });

</script>

{% endblock %}