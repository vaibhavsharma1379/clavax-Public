{% extends "base.html" %}
{% block title %}Update Profile{% endblock %}
{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Update Profile</h1>
    <form id="update-profile-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="first_name">First Name:</label>
            <input type="text" class="form-control" id="first_name" name="first_name" required>
        </div>
        <div class="form-group">
            <label for="last_name">Last Name:</label>
            <input type="text" class="form-control" id="last_name" name="last_name" required>
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="form-group">
            <label for="phone">Phone:</label>
            <input type="text" class="form-control" id="phone" name="phone" required>
        </div>
        <div class="form-group">
            <label for="date_of_birth">Date of Birth:</label>
            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required>
        </div>
        <div class="form-group">
            <label for="class_assigned">Class:</label>
            <select id="class_assigned" name="class_assigned" class="form-control" required>
                {% for class in classes %}
                    <option value="{{ class.id }}">{{ class.class_name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="button" class="btn btn-primary" id="update-btn">Update Profile</button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {


    const form = document.getElementById('update-profile-form');
    const accessToken = localStorage.getItem('access_token');
    axios.get('/api/student/profile/update/', {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    })
    .then(response => {
        const { data } = response;
        document.getElementById('first_name').value = data.first_name;
        document.getElementById('last_name').value = data.last_name;
        document.getElementById('email').value = data.email;
        document.getElementById('phone').value = data.phone;
        document.getElementById('date_of_birth').value = data.date_of_birth;
        const classAssignedSelect = document.getElementById('class_assigned');
        if (classAssignedSelect) {
            classAssignedSelect.value = data.class_assigned;
        }
        document.getElementById('status').checked = data.status;
        
    })
    .catch(error => {
        alert('Fetching failed: ' + JSON.stringify(error.response.data));  
        window.location.href = '/api/loginform/'; 
    });

   
    document.getElementById('update-btn').addEventListener('click', function() {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        axios.put('/api/student/profile/update/', data, {
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            alert('Profile updated successfully!');
        })
        .catch(error => {
            alert('Registration failed: ' + JSON.stringify(error.response.data));   
        });
    });
});
</script>

{% endblock %}
